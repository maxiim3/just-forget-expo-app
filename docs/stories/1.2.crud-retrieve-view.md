# Story 1.2: CRUD in Retrieve View

## Status
Draft

## Story
**As a** user searching for my thoughts,
**I want** to view and manage entries in the Retrieve view,
**so that** I can find and act on my notes using a list-based interface.

## Acceptance Criteria

1. Retrieve view displays a searchable list of all active entries
2. Search input filters entries by content (simple text match)
3. Tapping an entry opens the EditModal for editing
4. Long-press shows context menu (Archive/Delete) consistent with Grid view
5. Archived entries are accessible via toggle/filter
6. Empty state shown when no entries or no search results
7. Consistent action patterns with Grid view (same gestures, same feedback)

## Tasks / Subtasks

- [ ] Task 1: Create entry list component for Retrieve view (AC: 1)
  - [ ] Create `RetrieveEntryCard` component (similar style to GridCard but full-width)
  - [ ] Display entry content, timestamp
  - [ ] Add Pressable with onPress/onLongPress handlers

- [ ] Task 2: Replace placeholder with entry list (AC: 1)
  - [ ] Import `useAppStore` in retrieve.tsx
  - [ ] Fetch entries from store
  - [ ] Render entries in ScrollView/FlatList
  - [ ] Maintain existing SafeAreaView structure

- [ ] Task 3: Implement search functionality (AC: 2)
  - [ ] Add search TextInput at top of view
  - [ ] Create local state for search query
  - [ ] Filter entries by content.toLowerCase().includes(query)
  - [ ] Debounce search for performance (optional)

- [ ] Task 4: Add tap-to-edit functionality (AC: 3, 7)
  - [ ] Import `setEditingEntry` from store
  - [ ] Wire onPress to open EditModal
  - [ ] Import and render EditModal component

- [ ] Task 5: Add long-press context menu (AC: 4, 7)
  - [ ] Reuse/extract context menu pattern from Story 1.1
  - [ ] Wire Archive and Delete actions
  - [ ] Add confirmation for Delete

- [ ] Task 6: Add archived entries toggle (AC: 5)
  - [ ] Add toggle/tab for "Active" / "Archived" view
  - [ ] Filter entries based on selected tab
  - [ ] Style toggle consistent with app design

- [ ] Task 7: Handle empty states (AC: 6)
  - [ ] No entries: "No thoughts yet" message
  - [ ] No search results: "No matches found" message
  - [ ] Archived empty: "No archived thoughts" message

## Dev Notes

### Current State (retrieve.tsx)
- Placeholder only: "Coming in Phase 2" text
- SafeAreaView structure exists
- No entry display or interactivity

### Components to Reuse
- **EditModal** (`components/cards/EditModal.tsx`)
- **Context menu pattern** from Story 1.1 (Grid view)

### Store Methods Available (lib/store.ts)
- `entries` - All entries array
- `setEditingEntry(entry)` - Opens EditModal
- `archiveEntry(id)` - Archives entry
- `deleteEntry(id)` - Deletes entry

### File Locations
- Retrieve view: `app/(tabs)/retrieve.tsx`
- EditModal: `components/cards/EditModal.tsx`
- Store: `lib/store.ts`

### Design Guidance
- Full-width entry cards (not 2-column grid)
- Search input at top with sketch style
- List style similar to chat message list
- Keep "AI-powered search" for Phase 2 (just show text match for now)

### Styling Patterns
- Search input: `border-2 border-muted rounded-sketch p-4 font-caveat`
- Entry card: `border-4 border-primary rounded-sketch p-4 mb-3`
- Headers: `font-marker`
- Body text: `font-caveat`

### Note on Phase 2
This story implements **basic CRUD and text search only**. The AI-powered semantic search is deferred to Epic 4 (AI Retrieval). The header can mention "Search" instead of "AI-powered chat search".

## Testing

### Manual Testing Required
- [ ] Retrieve view shows list of entries
- [ ] Search filters entries correctly
- [ ] Tap entry → EditModal opens
- [ ] Edit → Save → Content updates
- [ ] Long-press → Context menu appears
- [ ] Archive → Entry moves to archived
- [ ] Delete → Confirmation → Entry removed
- [ ] Toggle between Active/Archived views
- [ ] Empty states display correctly

### Platforms to Test
- Web (primary)
- iOS Simulator / Expo Go
- Android Emulator / Expo Go

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2026-01-08 | 0.1 | Initial draft | Bob (SM) |

---

## Dev Agent Record

### Agent Model Used
_To be filled by dev agent_

### Debug Log References
_To be filled by dev agent_

### Completion Notes List
_To be filled by dev agent_

### File List
_To be filled by dev agent_

---

## QA Results
_To be filled by QA agent_
